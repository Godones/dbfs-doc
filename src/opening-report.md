# 文件系统与数据库

计算机的文件系统是一种存储和组织计算机数据的方法，它使得对数据的访问和查找变得容易，文件系统使用文件和树形目录的抽象逻辑概念代替了硬盘和光盘等物理设备使用数据块的概念，用户使用文件系统来保存数据而不必关心数据实际保存在硬盘（或者光盘）的地址为多少的数据块上，只需要记住这个文件的所属目录和文件名。在写入新数据之前，用户不必关心数据在硬存储介质上的数据块地址，硬盘上的存储空间管理（分配和释放）功能由文件系统自动完成，用户只需要记住
数据被写入到了哪个文件中。随着时间的推移，存储需求不断变化，数据量不断增加，文件系统必须是可靠的、持久的、安全的、高效的、容错的和可扩展的[1]，为了实现这些特性并跟上不断变化的计算需求和存储需求，不同的技术和文件系统随着时间的推移而被引入到操作系统中，但是绝大多数的文件系统实现仍然采用的是树状层次结构，提供给用户的接口仍然是 open,read/write 等。


在文件系统快速发展的同时，数据库系统同样也在随着需求的不断变化而快速迭代。数据库是以电子方式存储的系统数据集合，它可以包含任何类型的数据，包括文字、数字、图像、视频和文件。这些数据按一定的数据模型组织、描述和存储，具有较小冗余度、较高数据独立性和易扩展性，并可为各种用户共享。通常，数据库的实现以文件系统为基础，所有的数据库操作，如增删改查、备份等最后都会转换为对磁盘上文件的操作，但有时数据库并不希望受到文件系统实现带来的影响，一
个广泛的现象是许多数据库系统的实现都会包含一个缓存模块，以此来提高其性能和可靠性。除了一直占据主要地位的大型关系型数据库系统，如 Mysql、SQLserver等，近年来也出现了一些嵌入式数据库和许多 nosql 数据库，这些数据库与传统的数据库相比，其对系统资源的占用更小[2]，如 sqlite[3]，其与应用程序运行在同一个地址空间中，而不是像 Mysql 那样存在服务器端和客户端的区别，同时，新兴的 nosql数据库虽然功能不如传统的大型关系型数据库完善，但根据需求的变化，这些 nosql数据库在一些专有领域也有着不错的表现。

从数据库和文件系统的发展来看，两者是在互相促进，共同发展，从两者的功能来看，他们都是存储数据的一种管理方式。一种可以充分利用两者优势的方案是将数据库直接引入到文件系统中，让文件系统原生地具备数据库的能力，通过有效地结合两者的功能，使得用户在存储数据时不再担心原来那些可能会发生在传统文件系统中的数据丢失、数据错误问题。


# 研究现状

早期，数据库系统的基础是底层的文件系统，许多管理数据的特性都只是在数据库系统上得到体现，而近年来，文件系统的设计开发中越来越借鉴了数据库相关技术的思想，二者不断融合发展。日志文件系统就是在借鉴数据库系统的日志和事务特性之后发展出的一种文件系统。在对文件系统进行修改时，需要进行很多操作，比如在扩展一个文件的大小时，需要同时对文件的元信息和磁盘元信息修改，这些操作理论上是不允许被打断的。如果操作被打断，就可能造成文件系统出现不一致
的状态，虽然可以使用一些工具对这些情况进行修复，如 fsck，但这些工具在修复时需要扫描整个磁盘，繁琐且速度较慢。日志文件系统在修改磁盘数据时利用日志信息记录修改过程，如果文件系统发生崩溃，重启后只需要根据日志信息就可以恢复数据，从而保证数据的一致性和完整性。发展较早的日志文件系统 JFS[4]、XFS[5] 如今在某些系统上仍然广泛使用。而较新的 Btrfs[6]、Ext4[7]、NTFS 等具有日志功能的文件系统在服务器系统与桌面系统上占据着主要地位。除了对数据库的日志和简单事务的借鉴之外，许多适应新需求的文件系统实现在设计中会直接包含事务 ACID特性的设计，exF2FS[8]是一个事务性的日志文件系统，其允许事务跨越多个文件，应用程序可以显式指定与事务关联的文件，同时其允许使用少量内存执行事务并在一个事务中封装多个更新。DurableFS[9]提供了一种受限制的事务形式：文件打开和关
闭之间的操作自动形成具有原子性和持久性保证的事务。

一些文件系统的实现不再局限于在文件系统的设计上引入数据库系统的特性，而是选择直接基于数据库系统进行文件系统的实现，考虑到数据库系统提供的特性的实现复杂度，这种方案在实施难度上要远远小于重新设计文件系统。IFS[10]是一个
基于关系型数据库 POSTGRES 实现的文件系统，其向用户提供事务特性以及时间旅行功能，同时其使用多张关系表来构建层级文件系统以最大限度地支持传统 POSIX接口。Oracle iFS 是一个运行在数据库之上的文件系统，实质上，Oracle iFS 提供了文件系统和数据库之间的范式转换，同时提高了一些高级搜索和数据备份功能。国内学者[11]将 Oracle iFS 移植到 linux 的 VFS 模块中，使得用户对其使用就如原有的文件系统一样，并且将基于内容分类、关联访问、基于内容的访问、版本控制等功能扩展到 VFS 中。AMINO[12]是一个具有 ACID 语义的文件系统，其使用 Berkeley Database作为后备存储，将一个易于使用但功能强大的嵌套事务 API 导出到用户空间。应用程序可以开始、提交和中止事务，同时其设计了一个简单的 API，使协作进程能够共享事务。使用相同的 API，单个应用程序可以支持多个并发事务。该文件系统不仅为应用程序提供了 ACID 的额外好处，在性能方面也与 ext3 相当。


将数据库的功能引入到文件系统的工作依然在不断进行当中，但是将两者进行有机结合的工作近年来却止步不前，一方面，数据库系统已经变得愈加复杂，很多数据库已经不仅仅是一个独立的程序，将位于用户态的庞大的数据库系统移植到内核中并与文件系统交互看起来是一件不可能的事；另一方面，之前的许多工作发现，基于数据库的文件系统导致了不必要的性能损失，这导致了大多数学者将重心移到了文件系统的设计之上而不再关注如何更近一步地改善两者的关系从而提高性能。
如今数据库的发展愈加迅速，其速度远远超过了文件系统的发展。同时，许多单机数据库的出现也让移植数据库到内核中，并将其与文件系统结合变得简单，这些单机数据库不仅具备与那些大型数据库相当的性能，同时还具备良好的移植性。
