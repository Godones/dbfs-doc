# mdtest

mdtest是一款针对服务器元数据处理能力的基准测试工具，可以用来模拟对文件或目录的open/stat/close操作，然后返回报告。它支持MPI，可以用来协调大量客户端对服务器发起请求。

- -b: 目录树的分支参数
- -d: 指出测试运行的目录
- -I: 每个树节点包含的项目
- -z: 目录树的深度

各个文件系统的测试命令如下所示：

```
sudo mdtest -d dbfuse -b 6 -I 8 -z 3
```

![mdtest](assert/mdtest-1684205988754-1.svg)

图显示了测试结果。在mdtest测试中，总体来说DBFS的性能与最好的ext3相比在某些操作上具有一定的优势。在rename操作上，这个优势甚至可以达到数十倍。在File Stat 、Dir Stat两种查找操作上DBFS与ext3的没有较大的差距，这得益于DBFS中数据库快速的索引查找机制。在Tree creation 、 Tree removal 这类比较复杂的操作上DBFS与ext3的存在一定的差距，这可以从File creation、Directory creation 、Directory removal 等操作中得到原因，由于DBFS在这几个操作上本就比ext3慢了一个数量级，而Tree creation 操作是这几个简单操作的组合，因此总体下来就会导致这样的差距。

在ext3和ext4的fuse实现中，为了提高性能，其中加入了许多缓存机制，其缓存了文件系统的大部分元信息，这可以使得对于文件信息和对目录信息的获取速度大幅度增加。而这些信息也可以让删除，重命名等操作直接在内存中完成。在DBFS的实现中，本文并没有为Fuse提供专门的缓存机制，因此每一次的查找、删除操作都会直接对文件进行操作，相比其ext的文件系统，DBFS的元数据处理能力肯定会打折扣，但从图中也可以看出，即使DBFS没有元数据缓存的加持，在许多操作上同样也能达到较好的性能。如果为fuse的实现加入缓存，那其与ext的性能差距将会进一步缩小。
